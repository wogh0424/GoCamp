<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
		"-//mybatis.org//DTD Mapper 3.0//EN"
		"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
		
<mapper namespace="com.itbank.repository.FreeBoardDAO">
		<select id="selectAll" resultType="freeboard" parameterType="paging">
			select * from free_board
			
			where ${column} like '%${search}%'
				order by 
					idx desc 
				offset #{offset} rows
				fetch next #{perPage} rows only
		</select>
	
		<insert id="insertBoard" parameterType="freeboard">
			insert into free_board
				(title, writer, content) 
					values (#{title}, #{writer}, #{content})
		</insert>
		
		<insert id="insertFile" parameterType="hashmap">
			insert into free_board_file (free_board, filePath) 
			
				<foreach item="item" collection="list" separator="  UNION ALL  " >
					select #{upload}, #{item} from dual
			</foreach>
		</insert>
		
		<select id="selectMaxIdxFromUpload" resultType="int">   
		select max(idx) from free_board
	</select>

		
		<select id="selectOne" parameterType="int" resultType="freeboard">
		
			 SELECT 
		        free_board.idx,
		        free_board.title,
		        free_board.writer,
		        free_board.content,
		        (SELECT GROUP_CONCAT(filePath SEPARATOR ',')
		         FROM free_board_file
		         WHERE free_board_file.free_board = free_board.idx) AS filePath 
	 		  FROM free_board where idx = #{idx}
	   		  ORDER BY idx
		
<!-- 		SELECT *, -->
<!--       	 (SELECT GROUP_CONCAT(filePath, ',') -->
<!--         FROM free_board_file -->
<!--         WHERE free_board_file.free_board = free_board.idx) as filePath -->
<!-- 		FROM free_board -->
<!-- 		WHERE idx = #{idx} -->
		
<!-- 				select * -->
<!-- 				(select -->
<!-- 				select  -->
<!-- 				listagg(filePath, ',') -->
<!-- 					from free_board_file -->
<!-- 				where -->
<!-- 				 free_board_file.free_board = free_board.idx) as filePath -->
<!-- 				  from free_board where idx=#{idx} -->
		</select>
		
		<select id="selectFileList" parameterType="int" resultType="string">
				select filePath from free_board_file where free_board = #{idx}
	</select>
		
		
		<update id="updateViewCount" parameterType="int">
				update free_board
					set
						view_cnt = view_cnt + 1
					where
						idx = #{idx}
		</update>
		
		<select id="ViewCount" parameterType="int">
			select view_cnt from free_board where idx = #{idx}
		</select>
		
		<delete id="deleteFile" parameterType="int">
				delete from free_board_file where free_board = #{idx }
		</delete>
		
		<delete id="deleteFreeBoard" parameterType="int">
				delete from free_board where idx=#{idx}
		</delete>
		
		<update id="update"  parameterType="freeboard" >
				update free_board
					set title=#{title}, content=#{content} 
						where idx=#{idx}
		</update>
		
		<select id="selectCount" parameterType="paging" resultType="int">
				select count(*) from free_board where ${column} like '%${search}%'
		</select>
		
		<select id="getnick" parameterType="string" resultType="string">
			select nickname from member where userid = #{userid}
		</select>

</mapper>
		